<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Astrobloom Globe with Month Slider</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; font-family: sans-serif; }
    #globeViz { width: 100vw; height: 100vh; }
    #sliderContainer {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      color: white;
      font-size: 1.2em;
    }
    input[type="range"] { width: 60%; }
    #playBtn {
      margin-top: 10px;
      padding: 8px 16px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 8px;
      border: none;
    }
  </style>
  <script src="https://unpkg.com/globe.gl"></script>
</head>
<body>
  <div id="globeViz"></div>

  <div id="sliderContainer">
    <span id="monthLabel">January</span><br>
    <input type="range" id="monthSlider" min="0" max="11" step="1" value="0"><br>
    <button id="playBtn">▶ Play</button>
  </div>

  <script>
    const monthNames = ["January","February","March","April","May","June",
                        "July","August","September","October","November","December"];

    // Country centers (rough)
    const countries = {
      "Japan": { lat: 36.2, lng: 138.2, colors: ["#e8eb49","#f5a2ac","#f484d4","#e647b9","#ab8aec","#d56de3","#e898ec","#f399f0","#de4242","#c27d37","#e16473","#f1ebb2"] },
      "Alaska": { lat: 64.2, lng: -149.5, colors: ["#83b1dd","#649ac8","#a2d7ec","#6a5acd","#8f2da0","#d25db9","#cad239","#d9eaa5","#94dee1","#5cabcaff","#34879e","#4b6cb1"] },
      "Madagascar": { lat: -18.9, lng: 47.5, colors: ["#2e7d32","#4b9d4f","#6bc56f","#e1a2d6","#8be0dd","#98d6e7","#8ae5e5","#9adbed","#c71585","#edb232","#e2b330","#b288d1"] },
      "New Zealand": { lat: -40.9, lng: 174.9, colors: ["#ff1493","#ff1493","#ff8c00","#b22222","#b22222","#778899","#87ceeb","#ffb6c1","#ffff00","#e3e54e","#cb84c9","#b52212"] },
      "Fiji": { lat: -17.7, lng: 178.1, colors: ["#ebe41f","#efa3ee","#e28ee8","#ef6cae","#ea9cd4","#da48c2","#ffffff","#ff4500","#ea8ecb","#edaa92","#eea58b","#e69a87"] }
    };

    // Build the globe
    const GlobeObj = Globe()
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
      .ringMaxRadius(d => d.maxR)
      .ringPropagationSpeed(d => d.speed)
      .ringRepeatPeriod(d => d.period)
      .ringColor(d => t => {
        // Fade out effect
        const rgba = d.color.replace(')', `,${1 - t})`).replace('rgb', 'rgba');
        return rgba;
      });

    GlobeObj(document.getElementById('globeViz'));

    // Auto rotate
    GlobeObj.controls().autoRotate = true;
    GlobeObj.controls().autoRotateSpeed = 0.25;

    // Create ring set for a location + color
    function makeRings(lat, lng, color) {
      const rings = [];
      const numRipples = 6;
      const basePeriod = 8000;
      for (let i = 0; i < numRipples; i++) {
        rings.push({
          lat, lng,
          maxR: 3.5,
          speed: 2,
          period: basePeriod / (i + 1),
          color
        });
      }
      return rings;
    }

    // Slider + play
    const slider = document.getElementById("monthSlider");
    const label = document.getElementById("monthLabel");
    const playBtn = document.getElementById("playBtn");

    function updateGlobe(monthIndex) {
      label.textContent = monthNames[monthIndex];
      let rings = [];
      Object.values(countries).forEach(c => {
        rings = rings.concat(makeRings(c.lat, c.lng, c.colors[monthIndex]));
      });
      GlobeObj.ringsData(rings);
    }

    updateGlobe(0);

    slider.addEventListener("input", e => {
      updateGlobe(parseInt(e.target.value));
    });

    // Play button logic
    let isPlaying = false;
    let playInterval;
    playBtn.addEventListener("click", () => {
      if (!isPlaying) {
        isPlaying = true;
        playBtn.textContent = "⏸ Pause";
        playInterval = setInterval(() => {
          let nextMonth = (parseInt(slider.value) + 1) % 12;
          slider.value = nextMonth;
          updateGlobe(nextMonth);
        }, 1500);
      } else {
        isPlaying = false;
        playBtn.textContent = "▶ Play";
        clearInterval(playInterval);
      }
    });
  </script>
</body>
</html>
